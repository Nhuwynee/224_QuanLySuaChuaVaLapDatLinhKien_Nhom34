@model QLSuaChuaVaLapDat.ViewModel.BaoHanhSearchVM
<form id="searchForm" method="post" asp-action="TimKiemBaoHanh">
    <div class="search-container " id="warranty">
        <div class="search-header">
            <div class="search-title">Tìm kiếm Bảo hành</div>
            <div class="search-actions">
                <button class="btn btn-secondary">Làm mới</button>
                <button class="btn btn-primary">Tìm kiếm</button>
            </div>
        </div>

        <div class="search-fields">
            <div class="form-group">
                <label for="war-code">Mã bảo hành</label>
                <input name="MaDonDichVu" type="text" id="war-code"
                @(Model.baoHanhSearch.MaDonDichVu != null
                                            ? $"value={Model.baoHanhSearch.MaDonDichVu}"
                                            : "")
                placeholder="Nhập mã bảo hành...">
            </div>

            <div class="form-group">
                <label for="war-component">Mã linh kiện</label>
                <input name="MaLinhKien" type="text" id="war-component"
                @(Model.baoHanhSearch.MaLinhKien != null
                                            ? $"value={Model.baoHanhSearch.MaLinhKien}"
                                            : "")
                placeholder="Nhập mã linh kiện...">
            </div>

            <div class="form-group">
                <label for="war-customer">Khách hàng</label>
                <input name="SoDienThoaiKhachHang" type="text" id="war-customer"
                @(Model.baoHanhSearch.SoDienThoaiKhachHang != null
                                            ? $"value={Model.baoHanhSearch.SoDienThoaiKhachHang}"
                                            : "")
                placeholder="Nhập SĐT khách hàng...">
            </div>

            <div class="form-group">
                <label for="war-status">Trạng thái</label>
                @{
                    var trangThai = Model.baoHanhSearch.TrangThai;
                }
                <select name="TrangThai" id="war-status">
                    @if (trangThai == null)
                    {
                        <option value="" selected>Tất cả</option>
                    }else{
                        <option value="">Tất cả</option>
                    }

                    @if (trangThai == "active")
                    {
                        <option value="active" selected>Đang bảo hành</option>
                    }
                    else
                    {
                        <option value="active">Đang bảo hành</option>
                    }

                    @if (trangThai == "active")
                    {
                        <option value="expired" selected>Hết hạn</option>
                    }
                    else
                    {
                        <option value="expired">Hết hạn</option>
                    }



                </select>
            </div>

            <div class="form-group">
                <label for="war-from">Từ ngày</label>
                <input name="TuNgay" type="date"
                @(Model.baoHanhSearch.TuNgay != null
                                    ? $"value={Model.baoHanhSearch.TuNgay}"
                                    : "")
                id="war-from">
            </div>

            <div class="form-group">
                <label for="war-to">Đến ngày</label>
                <input name="DenNgay" type="date"
                @(Model.baoHanhSearch.DenNgay != null
                                    ? $"value={Model.baoHanhSearch.DenNgay}"
                                    : "")
                id="war-to">
            </div>
        </div>

        <div class="filter-sort">
            <div class="filter-section">
                <span>Lọc theo:</span>
                @{
                    var LoaiLinhKien = Model.baoHanhSearch.LoaiLinhKien;
                    var NhaSanXuat = Model.baoHanhSearch.NhaSanXuat;
                }
                <select name="LoaiLinhKien">
                    <option value=""></option>
                    @foreach(var item in Model.linhKiens)
                    {
                        if (item.IdLoaiLinhKien == LoaiLinhKien)
                        {
                            <option value="@item.IdLoaiLinhKien" selected>@item.TenLoaiLinhKien</option>

                        }
                        else
                        {
                            <option value="@item.IdLoaiLinhKien">@item.TenLoaiLinhKien</option>

                        }
                    }

                </select>
                <select name="NhaSanXuat">
                    <option value=""></option>
                    @foreach (var item in Model.nhaSanXuats)
                    {
                        if (item.IdNsx == NhaSanXuat)
                        {
                            <option value="@item.IdNsx" selected>@item.TenNsx</option>

                        }
                        else
                        {
                            <option value="@item.IdNsx">@item.TenNsx</option>

                        }
                       
                    }
                </select>
            </div>

            <div class="sort-section">
                <span>Sắp xếp theo:</span>
                @{
                    var xapSep = Model.baoHanhSearch.SapXepTheo;
                }
                <select name="SapXepTheo">
                    @if (string.IsNullOrEmpty(xapSep))
                    {
                        <option value="" selected>-- Chọn sắp xếp --</option>
                    }
                    else
                    {
                        <option value="">-- Chọn sắp xếp --</option>
                    }

                    @if (xapSep == "datedesc")
                    {
                        <option value="datedesc" selected>Ngày kích hoạt (mới nhất)</option>
                    }
                    else
                    {
                        <option value="datedesc">Ngày kích hoạt (mới nhất)</option>
                    }

                    @if (xapSep == "dateasc")
                    {
                        <option value="dateasc" selected>Ngày kích hoạt (cũ nhất)</option>
                    }
                    else
                    {
                        <option value="dateasc">Ngày kích hoạt (cũ nhất)</option>
                    }

                    @if (xapSep == "outdesc")
                    {
                        <option value="outdesc" selected>Ngày hết hạn (sớm nhất)</option>
                    }
                    else
                    {
                        <option value="outdesc">Ngày hết hạn (sớm nhất)</option>
                    }

                    @if (xapSep == "outasc")
                    {
                        <option value="outasc" selected>Ngày hết hạn (muộn nhất)</option>
                    }
                    else
                    {
                        <option value="outasc">Ngày hết hạn (muộn nhất)</option>
                    }
                </select>


            </div>
        </div>

        <div class="select-all-container">
            <label for="select-all-warranty" style="margin-top: 15px;">Chọn tất cả</label>
        </div>

        <table class="results-table">
            <thead>
                <tr>
                    <th><input type="checkbox" class="select-all" data-table="warranty"></th>
                    <th>Mã BH</th>
                    <th>Mã đơn</th>
                    <th>Số ĐT</th>
                    <th>Mã linh kiện/ lỗi</th>
                    <th>Linh kiện/ Loại lỗi</th>
                    <th>Loại dịch vụ</th>
                    <th>Khách hàng</th>
                    <th>Ngày kích hoạt</th>
                    <th>Ngày hết hạn</th>
                    <th>Trạng thái bảo hành</th>
                    <th>Điều kiện</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.ChiTietDonHangs)
                {
                    <tr>
                        <td><input type="checkbox" class="row-checkbox"></td>
                        <td>@item.idDonDichVu</td>
                        <td>@item.IDChiTietDonDichVu</td>
                        <td>@item.SDT</td>
                        @if (@item.MaLinhKien != null && item.MaLoi == null)
                        {
                            <td>@item.MaLinhKien</td>
                        }
                        else if (@item.MaLinhKien == null && item.MaLoi != null)
                        {
                            <td>@item.MaLoi</td>
                        }

                        @if (item.TenLinhKien != null)
                        {
                            <td>@item.TenLinhKien </td>
                        }
                        else if (item.TenLoi != null)
                        {
                            <td>@item.TenLoi</td>
                        }

                        <td>@item.LoaiDichVu</td>


                        <td>@item.TenKhachHang</td>


                        <td>@item.NgayKichHoat</td>

                        <td>@item.NgayHetHan</td>
                        @if (@item.TrangThaiBaoHanh == true)
                        {
                            <td><span class="status status-confirmed">Đang bảo hành</span></td>
                           
                        }
                        else
                        {
                            <td><span class="status status-cancelled">Hết bảo hành</span></td>
                        }

                        @if (@item.DieuKien != null)
                        {
                            <td>@item.DieuKien</td>
                        }
                        else
                        {
                            <td>Không có ĐK</td>
                        }
                        
                       
                        <td><button class="btn btn-edit">Sửa</button></td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="pagination">
            @{
                int totalPage = Model.Paging.TotalPage;
                int currentPage = Model.Paging.PageActive;
            }

            @for (int i = 1; i <= totalPage; i++)
            {
                <div class="page-item @(i == currentPage ? "active" : "")">@i</div>
            }
        </div>
    </div>
    <input type="hidden" id="page_active" name="PageActive" value="1" />
</form>

<script>
    const pageItems = document.querySelectorAll('.page-item');

        pageItems.forEach(item => {
        item.addEventListener('click', () => {
        // Xóa class active khỏi tất cả
        pageItems.forEach(i => i.classList.remove('active'));
        // Thêm class active cho item được click
        item.classList.add('active');

        // Lấy số trang từ text của item
        const pageNumber = item.innerText.trim();

        // Gán vào input hidden
        document.getElementById('page_active').value = pageNumber;

        // Gửi form
        submitForm();
        });
    });
       function submitForm() {
        document.getElementById("searchForm").submit();
    }
</script>