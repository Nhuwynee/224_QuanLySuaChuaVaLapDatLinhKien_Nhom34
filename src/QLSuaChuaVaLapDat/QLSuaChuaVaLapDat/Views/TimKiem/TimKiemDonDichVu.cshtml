@model IEnumerable<QLSuaChuaVaLapDat.Models.DonDichVu>
@{
    ViewData["Title"] = "Tìm kiếm";
}
<form id="searchForm" method="post" asp-action="TimKiemDonDichVu">
    <div class="search-container" id="service-orders">
        <div class="search-header">
            <div class="search-title">Tìm kiếm Đơn dịch vụ</div>
            <div class="search-actions">
                <button type="button" class="btn btn-secondary" onclick="resetForm()">Làm mới</button>
                <button type="submit" class="btn btn-primary">Tìm kiếm</button>
            </div>
        </div>

        <div class="search-fields">
            <div class="form-group">
                <label for="so-id">Mã đơn dịch vụ</label>
                <input type="text" id="so-id" name="MaDonDichVu" placeholder="Nhập mã đơn...">
            </div>

            <div class="form-group">
                <label for="so-customer">Khách hàng</label>
                <input type="text" id="so-customer" name="SDTKhachHang" placeholder="Nhập tên hoặc SĐT...">
            </div>

            <div class="form-group">
                <label for="so-technician">Kỹ thuật viên</label>
                <input type="text" id="so-technician" name="IDKyThuatVien" placeholder="Nhập id kỹ thuật viên...">
            </div>

            <div class="form-group">
                <label for="so-status">Trạng thái</label>
                <select id="so-status" name="TrangThaiDV" onchange="submitForm()">
                    <option value="">Tất cả</option>
                    <option value="processing">Đang xử lý</option>
                    <option value="completed">Hoàn thành</option>
                </select>
            </div>

            <div class="form-group">
                <label for="so-date-from">Từ ngày</label>
                <input type="date" id="so-date-from" name="TuNgay">
            </div>

            <div class="form-group">
                <label for="so-date-to">Đến ngày</label>
                <input type="date" id="so-date-to" name="DenNgay">
            </div>
        </div>

        <div class="filter-sort">
            <div class="filter-section">
                <span>Lọc theo:</span>
                <select name="LoaiThiếtBi" onchange="submitForm()">
                    <option value="">Loại thiết bị</option>
                    <option value="Máy tính">Máy tính</option>
                    <option value="Điện thoại">Điện thoại</option>
                    <option value="Thiết bị văn phòng">Thiết bị văn phòng</option>
                </select>
                <select name="LoaiDichVu" onchange="submitForm()">
                    <option value="">Loại dịch vụ</option>
                    <option value="Sửa chữa">Sửa chữa</option>
                    <option value="Lắp đặt">Lắp đặt</option>
                </select>
            </div>

            <div class="sort-section">
                <span>Sắp xếp theo:</span>
                <select name="SapXepTheo" onchange="submitForm()">
                    <option value="">Theo</option>
                    <option value="NgayTaoDesc">Ngày tạo (mới nhất)</option>
                    <option value="NgayTaoAsc">Ngày tạo (cũ nhất)</option>
                    <option value="TongTienDesc">Tổng tiền (cao nhất)</option>
                    <option value="TongTienAsc">Tổng tiền (thấp nhất)</option>
                </select>
            </div>
        </div>

        <div class="select-all-container">
            <label for="select-all-service-orders" style="margin-top: 15px;">
                <input type="checkbox" id="select-all-service-orders" class="select-all" data-table="service-orders"> Chọn tất cả
            </label>
        </div>

        <table class="results-table">
            <thead>
                <tr>
                    <th><input type="checkbox" class="select-all" data-table="service-orders"></th>
                    <th>Mã đơn</th>
                    <th>Khách hàng</th>
                    <th>Thiết bị</th>
                    <th>Loại dịch vụ</th>
                    <th>Trạng thái</th>
                    <th>Tổng tiền</th>
                    <th>Ngày tạo</th>
                    <th>Cập nhật</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td><input type="checkbox" class="row-checkbox"></td>
                        <td>@item.IdDonDichVu</td>
                        @if (item.IdKhachVangLaiNavigation != null)
                        {
                            <td>@item.IdKhachVangLaiNavigation.HoVaTen</td>
                        }
                        else
                        {
                            <td>@item.IdUserTaoDonNavigation.HoVaTen</td>
                        }
                        <td>@item.IdLoaiThietBiNavigation.TenLoaiThietBi</td>
                        <td>@item.LoaiDonDichVu</td>
                        @if (item.TrangThaiDon == "Hoàn thành")
                        {
                            <td><span class="status status-completed">@item.TrangThaiDon</span></td>
                        }
                        else if (item.TrangThaiDon == "Đang xử lý" || item.TrangThaiDon == "Đang sửa chữa")
                        {
                            <td><span class="status status-partial">@item.TrangThaiDon</span></td>
                        }
                        else if (item.TrangThaiDon == "Đã xác nhận")
                        {
                            <td><span class="status status-confirmed">@item.TrangThaiDon</span></td>
                        }
                        else if (item.TrangThaiDon == "Đã hủy")
                        {
                            <td><span class="status status-cancelled">@item.TrangThaiDon</span></td>
                        }
                        <td>@item.TongTien</td>
                        <td>@(item.NgayTaoDon.HasValue ? item.NgayTaoDon.Value.ToString("dd/MM/yyyy") : "")</td>
                        <td>@item.NgayChinhSua</td>
                        <td><button class="btn btn-edit">Sửa</button></td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="pagination">
            <div class="page-item active">1</div>
            <div class="page-item">2</div>
            <div class="page-item">3</div>
            <div class="page-item">...</div>
            <div class="page-item">10</div>
        </div>
    </div>
</form>

<script>
    function resetForm() {
        document.getElementById("searchForm").reset();
        // Optionally submit the form after resetting to refresh the results
        document.getElementById("searchForm").submit();
    }

    function submitForm() {
        document.getElementById("searchForm").submit();
    }
</script>